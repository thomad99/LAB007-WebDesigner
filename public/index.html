<!DOCTYPE html>
<html>
  <head>
    <title>LAB007 AI Website Redesigner</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="SpinnerLogo.png">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
             body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         line-height: 1.6;
         color: #333;
         background: linear-gradient(135deg, #2d1b69 0%, #1a103f 25%, #3d1f7a 50%, #2d1b69 75%, #1a103f 100%);
         background-size: 400% 400%;
         animation: gradientShift 8s ease infinite;
         min-height: 100vh;
         position: relative;
       }
       
       body::before {
         content: '';
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: 
           radial-gradient(circle at 20% 80%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
           radial-gradient(circle at 80% 20%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
           radial-gradient(circle at 40% 40%, rgba(75, 0, 130, 0.1) 0%, transparent 50%),
           url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
         pointer-events: none;
         z-index: -1;
       }
       
       @keyframes gradientShift {
         0% { background-position: 0% 50%; }
         50% { background-position: 100% 50%; }
         100% { background-position: 0% 50%; }
       }
      
      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2rem;
      }
      
      .header {
        text-align: center;
        margin-bottom: 3rem;
        color: white;
      }
      
      .header h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }
      
      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }
      
      .main-content {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      }
      
             .form-section {
        margin-bottom: 2rem;
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
      }
      
      .form-group {
        display: flex;
        flex-direction: column;
      }
      
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      
      label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #555;
      }
      
      input, select {
        padding: 1rem;
        font-size: 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        transition: border-color 0.3s ease;
        font-family: inherit;
      }
      
      input:focus, select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }
      
      .analyze-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background-color 0.3s ease;
        margin-top: 0.5rem;
      }
      
      .analyze-btn:hover {
        background: #218838;
      }
      
      .analyze-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      
      .submit-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 1.5rem 3rem;
        border-radius: 15px;
        cursor: pointer;
        font-size: 1.2rem;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 1rem;
        position: relative;
        overflow: hidden;
      }
      
      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
      }
      
      .submit-btn:active {
        transform: translateY(0);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
      }
      
      .submit-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      
      .submit-btn:disabled::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid transparent;
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
             #status-box {
         margin-top: 2rem;
         padding: 1.5rem;
         border: 2px solid #e1e5e9;
         border-radius: 15px;
         display: none;
         background: #000000;
         color: white;
       }
      
      .status-active {
        display: block !important;
      }
      
      .status-loading {
        text-align: center;
        color: #667eea;
      }
      
      /* Wave Animation for Analysis */
      .wave-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      
      .wave-container.active {
        opacity: 1;
      }
      
             .wave {
         position: absolute;
         bottom: 0;
         left: 0;
         width: 200%;
         height: 100%;
         background: linear-gradient(45deg, 
           rgba(102, 126, 234, 0.15) 0%, 
           rgba(118, 75, 162, 0.15) 25%, 
           rgba(102, 126, 234, 0.15) 50%, 
           rgba(118, 75, 162, 0.15) 75%, 
           rgba(102, 126, 234, 0.15) 100%);
         animation: wave-move 8s linear infinite;
         border-radius: 50% 50% 0 0;
       }
      
      .wave:nth-child(2) {
        animation-delay: -2s;
        opacity: 0.7;
      }
      
      .wave:nth-child(3) {
        animation-delay: -4s;
        opacity: 0.5;
      }
      
      .wave:nth-child(4) {
        animation-delay: -6s;
        opacity: 0.3;
      }
      
      @keyframes wave-move {
        0% {
          transform: translateX(-50%) translateY(0);
        }
        50% {
          transform: translateX(-25%) translateY(-20px);
        }
        100% {
          transform: translateX(0%) translateY(0);
        }
      }
      
      /* Analyze button wave effect */
      .analyze-btn.analyzing {
        position: relative;
        overflow: hidden;
      }
      
      .analyze-btn.analyzing::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
          transparent, 
          rgba(255, 255, 255, 0.3), 
          transparent);
        animation: analyze-wave 2s infinite;
      }
      
      @keyframes analyze-wave {
        0% { left: -100%; }
        100% { left: 100%; }
      }
      
      .status-error {
        border-color: #dc3545;
        background: #f8d7da;
        color: #721c24;
      }
      
      .status-success {
        border-color: #28a745;
        background: #d4edda;
        color: #155724;
      }
      
             .progress-container {
         text-align: center;
       }
       
       .spinner-container {
         display: flex;
         justify-content: center;
         margin: 1rem 0;
       }
       
       .progress-spinner {
         width: 60px;
         height: 60px;
         border-radius: 50%;
         box-shadow: 0 4px 8px rgba(0,0,0,0.1);
       }
      
      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 1rem 0;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
        transition: width 0.5s ease;
        border-radius: 10px;
      }
      
      .step-details {
        margin-top: 1rem;
        text-align: left;
      }
      
             .step-info {
         background: #1a1a1a;
         padding: 1rem;
         border-radius: 8px;
         border-left: 4px solid #667eea;
         margin: 0.5rem 0;
         color: white;
       }
       
       .step-info.success {
         border-left-color: #28a745;
         background: #0d2b0d;
         color: white;
       }
       
       .step-info.error {
         border-left-color: #dc3545;
         background: #2b0d0d;
         color: white;
       }
      
      .step-info p {
        margin: 0.25rem 0;
        font-size: 0.9rem;
      }
      
      .demo-item {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        margin: 0.5rem 0;
        justify-content: center;
      }
      
             .demo-btn {
         background: #667eea;
         color: white;
         padding: 0.75rem 1.5rem;
         text-decoration: none;
         border-radius: 8px;
         transition: background-color 0.3s ease;
         font-weight: 600;
         min-width: 120px;
         text-align: center;
       }
       
       .demo-btn:hover {
         background: #5a6fd8;
       }
       
       .copy-btn {
         background: #6c757d;
         color: white;
         border: none;
         padding: 0.75rem 1.5rem;
         border-radius: 8px;
         cursor: pointer;
         transition: background-color 0.3s ease;
         font-size: 0.9rem;
         min-width: 120px;
         text-align: center;
       }
      
             .copy-btn:hover {
         background: #5a6268;
       }
       
       .image-btn {
         background: #e91e63;
         color: white;
         padding: 0.75rem 1.5rem;
         text-decoration: none;
         border-radius: 8px;
         transition: background-color 0.3s ease;
         font-weight: 600;
         min-width: 120px;
         text-align: center;
         border: none;
         cursor: pointer;
         font-size: 0.9rem;
       }
       
       .image-btn:hover {
         background: #c2185b;
       }
       
       .mockup-item {
         display: flex;
         gap: 0.5rem;
         align-items: center;
         margin: 0.5rem 0;
         justify-content: center;
       }
       
       .prompts-section {
         margin-top: 2rem;
         background: rgba(255, 255, 255, 0.1);
         padding: 1.5rem;
         border-radius: 15px;
         border: 2px solid rgba(255, 255, 255, 0.2);
       }
       
       .prompts-container {
         margin-top: 1rem;
       }
       
       .prompt-item {
         background: rgba(0, 0, 0, 0.3);
         border-radius: 10px;
         margin-bottom: 1rem;
         overflow: hidden;
         border: 1px solid rgba(255, 255, 255, 0.1);
       }
       
       .prompt-header {
         background: rgba(255, 255, 255, 0.1);
         padding: 1rem;
         margin: 0;
         cursor: pointer;
         color: white;
         font-size: 1rem;
         display: flex;
         align-items: center;
         gap: 0.75rem;
         transition: background-color 0.3s ease;
       }
       
       .prompt-header:hover {
         background: rgba(255, 255, 255, 0.2);
       }
       
       .prompt-icon {
         font-size: 1.2rem;
       }
       
       .prompt-toggle {
         margin-left: auto;
         font-size: 0.8rem;
         transition: transform 0.3s ease;
       }
       
       .prompt-header.active .prompt-toggle {
         transform: rotate(180deg);
       }
       
       .prompt-content {
         display: none;
         padding: 1rem;
         background: rgba(0, 0, 0, 0.2);
       }
       
       .prompt-content.active {
         display: block;
       }
       
       .prompt-text {
         background: rgba(0, 0, 0, 0.5);
         padding: 1rem;
         border-radius: 8px;
         margin-bottom: 1rem;
         font-family: 'Courier New', monospace;
         font-size: 0.85rem;
         line-height: 1.4;
         color: #e0e0e0;
         white-space: pre-wrap;
         word-break: break-word;
         max-height: 300px;
         overflow-y: auto;
         border: 1px solid rgba(255, 255, 255, 0.1);
       }
      
      .download-btn {
        display: inline-block;
        background: #28a745;
        color: white;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        border-radius: 8px;
        margin-top: 1rem;
        transition: background-color 0.3s ease;
        font-weight: 600;
      }
      
      .download-btn:hover {
        background: #218838;
      }
      
             .mockup-result {
         margin-top: 2rem;
         text-align: center;
         background: rgba(255, 255, 255, 0.1);
         padding: 1.5rem;
         border-radius: 15px;
         border: 2px solid rgba(255, 255, 255, 0.2);
       }
      
      .mockup-result img {
        max-width: 100%;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        margin-top: 1rem;
      }
      
      .demo-links {
        margin-top: 1rem;
      }
      
      .demo-links a {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 0.75rem 1.5rem;
        text-decoration: none;
        border-radius: 8px;
        margin: 0.5rem;
        transition: background-color 0.3s ease;
      }
      
      .demo-links a:hover {
        background: #5a6fd8;
      }
      
      .analysis-results {
        background: #e8f4fd;
        border: 1px solid #bee5eb;
        border-radius: 10px;
        padding: 1.5rem;
        margin: 1rem 0;
        display: none;
      }
      
      .analysis-results h3 {
        color: #0c5460;
        margin-bottom: 1rem;
      }
      
      #remix-options {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 2rem;
        margin: 2rem 0;
        transition: all 0.3s ease;
      }
      
      #remix-options h3 {
        color: #495057;
        margin-bottom: 1.5rem;
        text-align: center;
      }
      
      .analysis-item {
        margin-bottom: 0.5rem;
        padding: 0.5rem;
        background: white;
        border-radius: 5px;
      }
      
      .suggestions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }
      
      .suggestion-tag {
        background: #667eea;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      
      .suggestion-tag:hover {
        background: #5a6fd8;
      }
      
      .analysis-section {
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        overflow: hidden;
      }
      
      .section-header {
        background: #f0f0f0;
        padding: 1rem 1.5rem;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .section-header:hover {
        background: #e0e0e0;
      }
      
      .section-content {
        padding: 1.5rem;
        display: none;
      }
      
      .section-content.active {
        display: block;
      }
      
             .section-header {
         display: flex;
         align-items: center;
         gap: 0.75rem;
       }
       
       .section-icon {
         width: 24px;
         height: 24px;
         flex-shrink: 0;
         filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
         transition: transform 0.3s ease, filter 0.3s ease;
       }
       
       .section-header:hover .section-icon {
         transform: scale(1.1);
         filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
       }
       
       .section-header::after {
         content: '▼';
         font-size: 0.8rem;
         transition: transform 0.3s ease;
         margin-left: auto;
       }
      
      .section-header.active::after {
        transform: rotate(180deg);
      }
      
      .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .metric-card {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .metric-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #667eea;
      }
      
      .metric-label {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
      }
      
      .keyword-tag {
        background: #667eea;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        margin: 0.25rem;
        display: inline-block;
      }
      
      .page-item {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        margin: 0.5rem 0;
        border-left: 4px solid #28a745;
      }
      
      .page-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 0.5rem;
      }
      
      .page-url {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        word-break: break-all;
      }
      
      .page-stats {
        display: flex;
        gap: 1rem;
        font-size: 0.8rem;
        color: #888;
      }
      
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
        
        .main-content {
          padding: 2rem 1.5rem;
        }
        
                 .form-row {
           grid-template-columns: 1fr;
         }
       }
      
       .remix-options {
         background: #f8f9fa;
         border: 1px solid #dee2e6;
         border-radius: 10px;
         padding: 2rem;
         margin: 2rem 0;
         transition: all 0.3s ease;
       }
       
       .remix-buttons {
         display: flex;
         gap: 1rem;
         flex-wrap: wrap;
       }
       
       .remix-v1 {
         flex: 1;
         min-width: 200px;
       }
       
       .remix-v2 {
         flex: 1;
         min-width: 200px;
         background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%) !important;
       }
       
       .remix-v2:hover {
         background: linear-gradient(135deg, #c2185b 0%, #ad1457 100%) !important;
       }
       
       .remix-v2-interface {
         background: #f8f9fa;
         border: 1px solid #dee2e6;
         border-radius: 10px;
         padding: 2rem;
         margin: 2rem 0;
         transition: all 0.3s ease;
       }
       
       .remix-v2-results {
         background: #f8f9fa;
         border: 1px solid #dee2e6;
         border-radius: 10px;
         padding: 2rem;
         margin: 2rem 0;
         transition: all 0.3s ease;
       }
       
       .v2-progress {
         font-size: 0.9rem;
         line-height: 1.4;
       }
       
       .v2-actions {
         display: flex;
         gap: 1rem;
         justify-content: center;
         flex-wrap: wrap;
       }
       
       .v2-actions .submit-btn {
         min-width: 150px;
       }
       
       @media (max-width: 768px) {
         .remix-buttons {
           flex-direction: column;
         }
         
         .v2-actions {
           flex-direction: column;
           align-items: center;
         }
       }
    </style>
  </head>
  <body>
         <!-- Wave Animation Container -->
     <div class="wave-container" id="wave-container">
       <div class="wave"></div>
       <div class="wave"></div>
       <div class="wave"></div>
       <div class="wave"></div>
     </div>
     
     <div class="container">
                                 <div class="header">
        <img src="lab007-trans.PNG" alt="LAB007 Logo" style="max-width: 300px; height: auto; border-radius: 10px;">
      </div>
      
             <div class="main-content">
         <form id="redesign-form">
           <!-- Remix v2 Interface (Hidden by default) -->
           <div id="remix-v2-interface" class="remix-v2-interface" style="display: none;">
             <h3 style="color: #333; margin-bottom: 1.5rem;">⚡ Remix v2 - Streaming AI Redesign</h3>
             <div class="form-group full-width">
               <label for="siteText">Paste your website text & menu structure:</label>
               <textarea id="siteText" placeholder="Paste your site text & menu here (copy from your website)" rows="10" style="width:100%; font-family: 'Courier New', monospace;"></textarea>
             </div>
             <div class="form-group full-width">
               <label for="sourceUrl">Source Website URL (for context):</label>
               <input type="url" id="sourceUrl" placeholder="https://www.example.com" style="width:100%;" />
             </div>
             <div class="form-group full-width">
               <label for="styleNotes">Optional: Design notes (fonts, vibe, accent color):</label>
               <input type="text" id="styleNotes" placeholder="e.g., modern, minimalist, blue accent, sans-serif fonts" style="width:100%;" />
             </div>
             <div class="form-group full-width">
               <label for="v2Theme">Theme:</label>
               <select id="v2Theme" style="width:100%;">
                 <option value="dark">Dark Theme</option>
                 <option value="light">Light Theme</option>
                 <option value="colorful">Colorful Theme</option>
                 <option value="minimalist">Minimalist Theme</option>
               </select>
             </div>
             <button type="button" id="generate-v2-btn" class="submit-btn" style="background: #e91e63;">
               ⚡ Generate Streaming HTML
             </button>
             <button type="button" id="back-to-v1" class="submit-btn" style="background: #6c757d; margin-top: 1rem;">
               ← Back to Remix v1
             </button>
           </div>
          <div class="form-section">
            <div class="form-group full-width">
              <label for="website">Your Current Website URL:</label>
              <input type="url" id="website" name="website" required placeholder="https://example.com">
                             <button type="button" id="analyze-btn" class="analyze-btn">Analyze Website</button>
            </div>
            
            <div id="analysis-results" class="analysis-results">
              <h3>Website Analysis Results</h3>
              <div id="analysis-content"></div>
              
              <!-- Comprehensive Analysis Sections -->
              <div id="comprehensive-analysis" style="display: none;">
                                 <div class="analysis-section">
                   <h4 onclick="toggleSection('page-structure')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M3 3h6v6H3V3zM15 3h6v6h-6V3zM3 15h6v6H3v-6zM15 15h6v6h-6v-6z" fill="#667eea"/>
                       <path d="M9 3h6v6H9V3zM9 15h6v6H9v-6z" fill="#764ba2"/>
                     </svg>
                     Page Structure & Content
                   </h4>
                   <div id="page-structure" class="section-content">
                     <div id="page-structure-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('seo-insights')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <circle cx="12" cy="12" r="3" fill="#667eea"/>
                       <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                     </svg>
                     SEO & Performance Insights
                   </h4>
                   <div id="seo-insights" class="section-content">
                     <div id="seo-insights-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('link-health')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                       <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" stroke="#764ba2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                     </svg>
                     Link Health & Navigation
                   </h4>
                   <div id="link-health" class="section-content">
                     <div id="link-health-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('keywords')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 14V2h12l5.59 5.59a2 2 0 0 1 0 2.82z" fill="#667eea"/>
                       <path d="M7 7h.01" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                     </svg>
                     Top Keywords & Content
                   </h4>
                   <div id="page-content" class="section-content">
                     <div id="keywords-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('page-content')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" fill="#667eea"/>
                       <path d="M14 2v6h6" stroke="#764ba2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                       <line x1="16" y1="13" x2="8" y2="13" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                       <line x1="16" y1="17" x2="8" y2="17" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                       <line x1="10" y1="9" x2="8" y2="9" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                     </svg>
                     Page Content & Details
                   </h4>
                   <div id="page-content" class="section-content">
                     <div id="page-content-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('meta-data')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" fill="#667eea"/>
                       <rect x="8" y="2" width="8" height="4" rx="1" ry="1" fill="#764ba2"/>
                       <line x1="8" y1="12" x2="16" y2="12" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                       <line x1="8" y1="16" x2="16" y2="16" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                       <line x1="8" y1="20" x2="12" y2="20" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                     </svg>
                     Meta Data Summary
                   </h4>
                   <div id="meta-data" class="section-content">
                     <div id="meta-data-content"></div>
                   </div>
                 </div>
                 
                 <div class="analysis-section">
                   <h4 onclick="toggleSection('navigation-analysis')" class="section-header">
                     <svg class="section-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                       <circle cx="12" cy="12" r="3" fill="#667eea"/>
                       <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1" stroke="#764ba2" stroke-width="2" stroke-linecap="round"/>
                       <path d="M12 1l3 3-3 3-3-3 3-3z" fill="#764ba2"/>
                     </svg>
                     Navigation Analysis
                   </h4>
                   <div id="navigation-analysis" class="section-content">
                     <div id="navigation-analysis-content"></div>
                   </div>
                 </div>
              </div>
            </div>
          </div>
          
                     <!-- Remix Options - Hidden until analysis is complete -->
           <div id="remix-options" style="display: none;">
            
                         <div class="form-group">
               <label for="theme">Preferred Style:</label>
                              <select id="theme" name="theme" required>
                  <option value="">Select a style</option>
                  <option value="clean-white">Clean White</option>
                  <option value="dark-black">Dark Black</option>
                  <option value="colorful">Colorful</option>
                  <option value="wave">Wave Theme</option>
                  <option value="minimalist">Minimalist</option>
                  <option value="corporate">Corporate Professional</option>
                  <option value="creative">Creative & Artistic</option>
                  <option value="tech-futuristic">Tech Futuristic</option>
                  <option value="elegant-luxury">Elegant Luxury</option>
                </select>
             </div>
             
             <!-- Page Count Selector -->
             <div id="page-count-selector" class="form-group" style="display: none;">
               <label id="page-count-label" for="page-count-select">Choose how many pages to remix:</label>
               <select id="page-count-select" name="pageCount">
                 <option value="1">1 page</option>
               </select>
               <small style="color: #666; margin-top: 0.25rem; display: block;">
                 💡 Tip: Choose fewer pages for faster testing. You can always run more later.
               </small>
             </div>
            
                                                   <div class="remix-buttons">
                            <button type="submit" id="submit-btn" class="submit-btn remix-v1">
                              🚀 Remix v1 - Multi-Page AI
                            </button>
                            <button type="button" id="remix-v2-btn" class="submit-btn remix-v2">
                              ⚡ Remix v2 - Streaming AI
                            </button>
                          </div>
          </div>
        </form>
        
                                   <div id="status-box"></div>
                  
                  <!-- Remix v2 Results Section -->
                  <div id="remix-v2-results" class="remix-v2-results" style="display: none;">
                    <h3 style="color: #333; margin-bottom: 1.5rem;">⚡ Remix v2 Results</h3>
                    <div id="v2-progress" class="v2-progress" style="background:#111; color:#0f0; padding:1rem; border-radius:8px; white-space:pre-wrap; margin-bottom:1rem; font-family: 'Courier New', monospace; max-height: 200px; overflow-y: auto;"></div>
                                         <div id="v2-preview-container" style="margin-top: 1rem;">
                       <div style="text-align: center; padding: 2rem; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 10px;">
                         <h4 style="color: #333; margin-bottom: 1rem;">HTML Generated Successfully! 🎉</h4>
                         <p style="color: #666; margin-bottom: 1.5rem;">Your redesigned website HTML has been generated with LAB007 branding.</p>
                         <button id="v2-open-new-tab" class="submit-btn" style="background: #28a745; margin: 0 0.5rem; display: none;">🌐 Open in New Tab</button>
                         <button id="v2-download" class="submit-btn" style="background: #667eea; margin: 0 0.5rem; display: none;">💾 Download HTML</button>
                         <button id="v2-copy" class="submit-btn" style="background: #6c757d; margin: 0 0.5rem; display: none;">📋 Copy HTML</button>
                       </div>
                     </div>
                                         <div class="v2-actions" style="margin-top: 1rem; text-align: center;">
                       <button id="back-to-v2-interface" class="submit-btn" style="background: #6c757d;">← Back to Input</button>
                     </div>
                  </div>
         
       </div>
     </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing application...');
        
                 const form = document.getElementById('redesign-form');
         const statusBox = document.getElementById('status-box');
         const analyzeBtn = document.getElementById('analyze-btn');
         const analysisResults = document.getElementById('analysis-results');
         const analysisContent = document.getElementById('analysis-content');
         const remixOptions = document.getElementById('remix-options');
         const submitBtn = document.getElementById('submit-btn');
         
         // Remix v2 elements
         const remixV2Btn = document.getElementById('remix-v2-btn');
         const remixV2Interface = document.getElementById('remix-v2-interface');
         const remixV2Results = document.getElementById('remix-v2-results');
         const generateV2Btn = document.getElementById('generate-v2-btn');
         const v2Progress = document.getElementById('v2-progress');
         
         const v2Download = document.getElementById('v2-download');
         const v2Copy = document.getElementById('v2-copy');

                 console.log('Elements found:', {
           form: !!form,
           statusBox: !!statusBox,
           analyzeBtn: !!analyzeBtn,
           analysisResults: !!analysisResults,
           analysisContent: !!analysisContent,
           remixOptions: !!remixOptions,
           submitBtn: !!submitBtn
         });

                 let selectedOption = 'clone';
         let isAnalyzing = false;
 
         // Website analysis
        analyzeBtn.addEventListener('click', async function() {
          console.log('Analyze button clicked');
          const website = document.getElementById('website').value;
          if (!website) {
            alert('Please enter a website URL first');
            return;
          }
          
          if (isAnalyzing) return;
          
                     isAnalyzing = true;
           analyzeBtn.disabled = true;
           analyzeBtn.innerHTML = 'Analyzing...';
           analyzeBtn.classList.add('analyzing');
           
                       // Activate wave animation
            const waveContainer = document.getElementById('wave-container');
            console.log('Wave container found:', !!waveContainer);
            if (waveContainer) {
              waveContainer.classList.add('active');
              console.log('Wave animation activated');
            } else {
              console.error('Wave container not found!');
            }
          
          try {
            console.log('Making analysis request for:', website);
            const response = await fetch('/api/analyze-website', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ website: normalizeUrl(website) })
            });
            
            const data = await response.json();
            console.log('Analysis response:', data);
            
            if (data.error) {
              throw new Error(data.error);
            }
            
                         // Display analysis results with comprehensive error handling
             let analysisHTML = '';
             
             // Title
             analysisHTML += '<div class="analysis-item">' +
               '<strong>Title:</strong> ' + (data.title || 'Not found') + '</div>';
             
             // Description
             analysisHTML += '<div class="analysis-item">' +
               '<strong>Description:</strong> ' + (data.description || 'Not found') + '</div>';
             
             // Business Type
             analysisHTML += '<div class="analysis-item">' +
               '<strong>Estimated Business Type:</strong> ' + (data.estimatedBusinessType || 'Not detected') + '</div>';
             
             // Suggested Themes with safe handling
             analysisHTML += '<div class="analysis-item">' +
               '<strong>Suggested Themes:</strong>' +
               '<div class="suggestions">';
             
             if (data.suggestedThemes && Array.isArray(data.suggestedThemes) && data.suggestedThemes.length > 0) {
               data.suggestedThemes.forEach(function(theme) {
                 if (theme && typeof theme === 'string') {
                   analysisHTML += '<span class="suggestion-tag" onclick="selectTheme(\'' + theme + '\')">' + theme + '</span>';
                 }
               });
             } else {
                               // Fallback themes
                analysisHTML += '<span class="suggestion-tag" onclick="selectTheme(\'clean-white\')">Clean White</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'dark-black\')">Dark Black</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'colorful\')">Colorful</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'wave\')">Wave Theme</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'minimalist\')">Minimalist</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'corporate\')">Corporate</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'creative\')">Creative</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'tech-futuristic\')">Tech</span>' +
                              '<span class="suggestion-tag" onclick="selectTheme(\'elegant-luxury\')">Luxury</span>';
             }
             
             analysisHTML += '</div></div>';
             
             // Logo info
             if (data.logo) {
               analysisHTML += '<div class="analysis-item"><strong>Logo Found:</strong> Yes</div>';
             }
             
             analysisContent.innerHTML = analysisHTML;
            
                         // Show comprehensive analysis if available
             if (data.totalPages !== undefined) {
               document.getElementById('comprehensive-analysis').style.display = 'block';
               populateComprehensiveAnalysis(data);
             } else {
               // Hide comprehensive analysis if data is incomplete
               document.getElementById('comprehensive-analysis').style.display = 'none';
             }
            
            analysisResults.style.display = 'block';
            
                         // Show remix options after successful analysis
             remixOptions.style.display = 'block';
             
             // Show page count selector if multiple pages were found
             if (data.totalPages && data.totalPages > 1) {
               document.getElementById('page-count-selector').style.display = 'block';
               document.getElementById('page-count-label').textContent = `Found ${data.totalPages} pages. Choose how many to remix:`;
               document.getElementById('page-count-select').innerHTML = '';
               for (let i = 1; i <= Math.min(data.totalPages, 10); i++) {
                 const option = document.createElement('option');
                 option.value = i;
                 option.textContent = i + (i === 1 ? ' page' : ' pages');
                 document.getElementById('page-count-select').appendChild(option);
               }
               // Set default to 2 pages for faster testing
               if (data.totalPages >= 2) {
                 document.getElementById('page-count-select').value = '2';
               }
             } else {
               document.getElementById('page-count-selector').style.display = 'none';
             }
            
                         // Note: Business type field removed - using default 'general' value
            
            console.log('Analysis completed successfully');
            
                     } catch (error) {
             console.error('Analysis error:', error);
             alert('Error analyzing website: ' + error.message);
             
             // Show remix options even on failure with fallback data
             remixOptions.style.display = 'block';
             
             // Show basic analysis results with fallback data
             analysisContent.innerHTML = '<div class="analysis-item">' +
               '<strong>Title:</strong> Analysis completed with limited data</div>' +
               '<div class="analysis-item">' +
               '<strong>Description:</strong> Basic analysis completed</div>' +
               '<div class="analysis-item">' +
               '<strong>Estimated Business Type:</strong> General Business</div>' +
               '<div class="analysis-item">' +
               '<strong>Suggested Themes:</strong>' +
               '<div class="suggestions">' +
               '<span class="suggestion-tag" onclick="selectTheme(\'clean-white\')">Clean White</span>' +
               '<span class="suggestion-tag" onclick="selectTheme(\'dark-black\')">Dark Black</span>' +
               '<span class="suggestion-tag" onclick="selectTheme(\'colorful\')">Colorful</span>' +
               '</div></div>';
             
             analysisResults.style.display = 'block';
             
           } finally {
             isAnalyzing = false;
             analyzeBtn.disabled = false;
             analyzeBtn.innerHTML = 'Analyze Website';
             analyzeBtn.classList.remove('analyzing');
             
             // Deactivate wave animation
             const waveContainer = document.getElementById('wave-container');
             if (waveContainer) {
               waveContainer.classList.remove('active');
               console.log('Wave animation deactivated');
             }
           }
        });

        // Theme selection from suggestions
        window.selectTheme = function(theme) {
          console.log('Theme selected:', theme);
          document.getElementById('theme').value = theme;
        };

        // Form submission
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          console.log('Form submitted');
          
          if (isAnalyzing) {
            alert('Please wait for website analysis to complete');
            return;
          }
          
                     const website = document.getElementById('website').value;
           const theme = document.getElementById('theme').value;
           const pageCount = document.getElementById('page-count-select').value || '1';
           
           if (!website || !theme) {
             alert('Please fill in all required fields');
             return;
           }
           
           console.log('Form data:', { website, theme, pageCount });
          
          // Show v1 interface and hide v2
          remixV2Interface.style.display = 'none';
          remixV2Results.style.display = 'none';
          
          statusBox.className = 'status-active status-loading';
          statusBox.innerHTML = '<div class="progress-container">' +
            '<h3 style="color: white;">Starting the redesign process...</h3>' +
            '<div class="spinner-container">' +
            '<video autoplay muted loop playsinline class="progress-spinner">' +
            '<source src="LAB007 Spinner.mp4" type="video/mp4">' +
            '</video>' +
            '</div>' +
            '<p id="current-step" style="color: white;">Initializing...</p>' +
            '<div class="step-details" id="step-details"></div>' +
            '</div>';

                     const formData = {
             website: normalizeUrl(website),
             theme: theme,
             pageCount: parseInt(pageCount)
           };

          try {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<video autoplay muted loop playsinline style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"><source src="LAB007 Spinner.mp4" type="video/mp4"></video>Processing...';
            
            // Activate wave animation for redesign process
            const waveContainer = document.getElementById('wave-container');
            if (waveContainer) {
              waveContainer.classList.add('active');
              console.log('Wave animation activated for redesign');
            }
            
            const endpoint = '/api/clone-website';
            console.log('Making request to:', endpoint);
            
            const response = await fetch(endpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(formData)
            });
            
            const data = await response.json();
            console.log('Response received:', data);
            
            if (data.error) {
              throw new Error(data.error);
            }
            
            console.log('Initial response received:', data);
            updateProgress(10, 'Job started successfully');
            
            pollStatus(data.jobId);
                       } catch (error) {
               console.error('Error in form submission:', error);
               statusBox.className = 'status-active status-error';
               statusBox.innerHTML = '<h3>Error Starting Process</h3>' +
                 '<p><strong>Error:</strong> ' + error.message + '</p>' +
                 '<p>Please check your input and try again.</p>' +
                 (error.message.includes('chatgpt_prompts') ? 
                   '<p><strong>Database Issue:</strong> Missing columns detected. <button onclick="setupDatabase()" style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; margin-top: 0.5rem; cursor: pointer;">🔧 Fix Database</button></p>' : '');
               submitBtn.disabled = false;
               submitBtn.innerHTML = '🚀 Remix v1 - Multi-Page AI';
            
            // Deactivate wave animation on error
            const waveContainer = document.getElementById('wave-container');
            if (waveContainer) {
              waveContainer.classList.remove('active');
              console.log('Wave animation deactivated due to error');
            }
          }
        });
        
        // Remix v2 button click handler
        remixV2Btn.addEventListener('click', function() {
          console.log('Remix v2 button clicked');
          
          // Hide v1 interface and show v2
          form.style.display = 'none';
          remixV2Interface.style.display = 'block';
          remixV2Results.style.display = 'none';
          
          // Update button text
          submitBtn.innerHTML = '🚀 Remix v1 - Multi-Page AI';
        });
        
        // Back to v1 button handler
        document.getElementById('back-to-v1').addEventListener('click', function() {
          console.log('Back to v1 button clicked');
          
          // Show v1 interface and hide v2
          form.style.display = 'block';
          remixV2Interface.style.display = 'none';
          remixV2Results.style.display = 'none';
          
          // Reset button text
          submitBtn.innerHTML = '🚀 Remix v1 - Multi-Page AI';
        });
        
        // Generate v2 button click handler
        generateV2Btn.addEventListener('click', async function() {
          console.log('Generate v2 button clicked');
          
          const siteText = document.getElementById('siteText').value;
          const sourceUrl = document.getElementById('sourceUrl').value;
          const styleNotes = document.getElementById('styleNotes').value;
          const theme = document.getElementById('v2Theme').value;
          
          if (!siteText) {
            alert('Please paste your website text first');
            return;
          }
          
          // Show results section and hide interface
          remixV2Interface.style.display = 'none';
          remixV2Results.style.display = 'block';
          
          // Clear previous results
          v2Progress.textContent = '';
          v2Download.style.display = 'none';
          v2Copy.style.display = 'none';
          
          // Disable button and show loading
          generateV2Btn.disabled = true;
          generateV2Btn.innerHTML = '⚡ Generating...';
          
          try {
            console.log('Starting v2 generation:', { sourceUrl, theme, styleNotes, textLength: siteText.length });
            
            const response = await fetch('/api/remix-v2', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ sourceUrl, siteText, theme, styleNotes })
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            // Handle streaming response
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let fullText = '';
            
            while (true) {
              const { value, done } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value, { stream: true });
              fullText += chunk;
              
              // Update progress display
              v2Progress.textContent += chunk;
              v2Progress.scrollTop = v2Progress.scrollHeight;
            }
            
                                      // Process the streamed content to extract HTML
             const html = processStreamedContent(fullText);
             
             // Add LAB007 branding to the HTML
             const brandedHtml = addLAB007BrandingV2(html);
             
             // Store HTML for download/copy and new tab
             window.generatedV2HTML = brandedHtml;
             
             // Show action buttons
             document.getElementById('v2-open-new-tab').style.display = 'inline-block';
             document.getElementById('v2-download').style.display = 'inline-block';
             document.getElementById('v2-copy').style.display = 'inline-block';
            
            console.log('V2 generation completed successfully');
            
          } catch (error) {
            console.error('Error in v2 generation:', error);
            v2Progress.textContent += `\n\n❌ Error: ${error.message}`;
          } finally {
            // Re-enable button
            generateV2Btn.disabled = false;
            generateV2Btn.innerHTML = '⚡ Generate Streaming HTML';
          }
        });
        
                 // Open in new tab button handler
         document.getElementById('v2-open-new-tab').addEventListener('click', function() {
           if (window.generatedV2HTML) {
             const newWindow = window.open('', '_blank');
             newWindow.document.write(window.generatedV2HTML);
             newWindow.document.close();
           }
         });
         
         // Download button handler
         v2Download.addEventListener('click', function() {
           if (window.generatedV2HTML) {
             downloadFile('remix-v2.html', window.generatedV2HTML);
           }
         });
         
         // Copy button handler
         v2Copy.addEventListener('click', function() {
           if (window.generatedV2HTML) {
             copyToClipboard(window.generatedV2HTML);
           }
         });
        
        // Back to v2 interface button handler
        document.getElementById('back-to-v2-interface').addEventListener('click', function() {
          console.log('Back to v2 interface button clicked');
          
          // Show v2 interface and hide results
          remixV2Interface.style.display = 'block';
          remixV2Results.style.display = 'none';
        });
        
                 // Helper functions for v2
         function processStreamedContent(fullText) {
           // Extract HTML from the streamed content
           // This is a simplified approach - you might need to adjust based on actual API response format
           const lines = fullText.split(/\r?\n/).filter(l => l.startsWith('data: '));
           let html = '';
           
           for (const line of lines) {
             if (line === 'data: [DONE]') break;
             try {
               const obj = JSON.parse(line.replace('data: ', ''));
               if (obj.choices && obj.choices[0] && obj.choices[0].delta && obj.choices[0].delta.content) {
                 html += obj.choices[0].delta.content;
               }
             } catch { /* ignore parse errors on partial lines */ }
           }
           
           // If no structured data found, return the raw text (fallback)
           return html.trim() || fullText;
         }
         
         // Function to add LAB007 branding to v2 HTML
         function addLAB007BrandingV2(html) {
           // Find the <head> tag and add favicon
           if (html.includes('<head>')) {
             const faviconLink = '<link rel="icon" type="image/png" href="/SpinnerLogo.png">';
             html = html.replace('<head>', `<head>\n    ${faviconLink}`);
           }
           
           // Find the <body> tag and add LAB007 logo at the top
           if (html.includes('<body>')) {
             const logoHeader = `
    <!-- LAB007 AI Redesigned Website -->
    <header style="background: #000000; color: white; padding: 1rem; text-align: center; border-bottom: 3px solid #667eea;">
      <img src="/lab007-trans.PNG" alt="LAB007 Logo" style="max-width: 200px; height: auto; margin-bottom: 0.5rem;">
      <div style="font-size: 0.9rem; opacity: 0.8;">AI-Powered Website Redesign</div>
      <div style="font-size: 0.8rem; opacity: 0.6; margin-top: 0.25rem;">Remix v2 - Streaming AI</div>
    </header>`;
             
             html = html.replace('<body>', `<body>\n    ${logoHeader}`);
           }
           
           return html;
         }
        
        
        
        function downloadFile(filename, text) {
          const blob = new Blob([text], { type: 'text/html;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          a.click();
          URL.revokeObjectURL(url);
        }
        
        async function pollStatus(jobId) {
          try {
            console.log('Polling status for job:', jobId);
            const response = await fetch('/api/status/' + jobId);
            const data = await response.json();
            
            if (data.error) {
              console.error('Status check error:', data.error);
              statusBox.className = 'status-active status-error';
              statusBox.innerHTML = '<h3>Error Checking Status</h3>' +
                '<p><strong>Error:</strong> ' + data.error + '</p>';
              return;
            }

            console.log('Status update for job', jobId, ':', data);
            
            // Update progress based on status
            let progress = 0;
            let currentStep = '';
            let stepDetails = '';
            
            switch (data.status) {
              case 'scraping':
                progress = 25;
                currentStep = 'Scraping Website Content';
                stepDetails = '<div class="step-info">' +
                  '<p><strong>What is happening:</strong> Analyzing your website structure and extracting content</p>' +
                  '<p><strong>Current task:</strong> Reading HTML, finding logos, navigation, and content</p>' +
                  '<p><strong>Website:</strong> ' + data.website + '</p>' +
                  '</div>';
                break;
                
              case 'analyzing':
                progress = 50;
                currentStep = 'AI Content Analysis';
                                 stepDetails = '<div class="step-info">' +
                   '<p><strong>What is happening:</strong> AI is processing your content and planning the redesign</p>' +
                   '<p><strong>Current task:</strong> Understanding your content structure and business needs</p>' +
                   '<p><strong>Business:</strong> General Business (Default)</p>' +
                   '</div>';
                break;
                
                             case 'generating':
                 progress = 75;
                 currentStep = 'Creating Professional Website';
                 stepDetails = '<div class="step-info">' +
                   '<p><strong>What is happening:</strong> AI is building your complete redesigned website with unique pages</p>' +
                   '<p><strong>Current task:</strong> Creating individual pages for each navigation item with rich content</p>' +
                   '<p><strong>Theme:</strong> ' + document.getElementById('theme').value + '</p>' +
                   '<p><strong>Features:</strong> Modern design, responsive layout, functional navigation</p>' +
                   '</div>';
                 break;
                 
                                case 'processing_page':
                   // Calculate progress based on current page vs total pages
                   if (data.current_page && data.total_pages) {
                     progress = 75 + Math.round((data.current_page / data.total_pages) * 20); // 75% to 95%
                   } else {
                     progress = 75;
                   }
                   currentStep = 'Processing Individual Pages';
                   stepDetails = '<div class="step-info">' +
                     '<p><strong>What is happening:</strong> AI is redesigning each page one by one</p>' +
                     '<p><strong>Current task:</strong> ' + (data.current_page || 'Unknown') + ' of ' + (data.total_pages || 'Unknown') + ' pages</p>' +
                     '<p><strong>Progress:</strong> Page ' + (data.current_page || 'Unknown') + ' is being sent to ChatGPT</p>' +
                     '<p><strong>Speed:</strong> Processing ' + (data.total_pages || 'Unknown') + ' pages for faster testing</p>' +
                     '</div>';
                   break;
                 
               case 'generating_mockup':
                 progress = 95;
                 currentStep = 'Creating Design Mockup';
                 stepDetails = '<div class="step-info">' +
                   '<p><strong>What is happening:</strong> AI is generating a visual mockup of your redesigned website</p>' +
                   '<p><strong>Current task:</strong> Creating professional mockup image with DALL-E</p>' +
                   '<p><strong>Features:</strong> High-quality design preview, modern aesthetics</p>' +
                   '</div>';
                 break;
                
                                              case 'completed':
                   progress = 100;
                   currentStep = 'Website Ready! 🎉';
                   stepDetails = '<div class="step-info success">' +
                     '<p><strong>Your professional redesigned website is ready!</strong></p>' +
                     '<p><strong>Features:</strong> ' + (data.total_pages || 'Multiple') + ' unique pages, modern design, responsive layout</p>' +
                     '<p><strong>Speed:</strong> Completed ' + (data.total_pages || 'all') + ' pages for faster testing</p>' +
                     '</div>';
                   break;
                
              default:
                if (data.status.startsWith('error:')) {
                  progress = 0;
                  currentStep = 'Error Occurred';
                  stepDetails = '<div class="step-info error">' +
                    '<p><strong>Error:</strong> ' + data.status.replace('error: ', '') + '</p>' +
                    '<p>Please try again or contact support if the problem persists.</p>' +
                    '</div>';
                } else {
                  progress = 10;
                  currentStep = 'Processing...';
                  stepDetails = '<div class="step-info">' +
                    '<p><strong>Status:</strong> ' + data.status + '</p>' +
                    '<p>Please wait while we process your request...</p>' +
                    '</div>';
                }
            }
            
            // Update the UI
            updateProgress(progress, currentStep);
            document.getElementById('step-details').innerHTML = stepDetails;
            
            // Continue polling if not completed or errored
            if (data.status && !data.status.startsWith('error') && data.status !== 'completed') {
              setTimeout(function() { pollStatus(jobId); }, 2000);
                         } else if (data.status === 'completed') {
               statusBox.className = 'status-active status-success';
               
               // Hide progress elements and show completion with new buttons
               const progressContainer = document.querySelector('.progress-container');
               if (progressContainer) {
                 progressContainer.style.display = 'none';
               }
               
                               if (data.demoUrls) {
                  statusBox.innerHTML += '<div class="demo-links">' +
                    data.demoUrls.map(function(url, index) {
                      return '<div class="demo-item">' +
                        '<a href="' + url + '" target="_blank" class="demo-btn">View Remix</a>' +
                        '<button onclick="copyToClipboard(\'' + url + '\')" class="copy-btn">Copy Link</button>' +
                        '</div>';
                    }).join('') +
                    '</div>';
                }
                
                // Add mockup image if available
                if (data.mockupUrl) {
                  statusBox.innerHTML += '<div class="mockup-result">' +
                    '<h4 style="color: white; margin: 1rem 0;">🎨 Design Preview</h4>' +
                    '<div class="mockup-item">' +
                    '<a href="' + data.mockupUrl + '" target="_blank" class="image-btn">View Image Sample</a>' +
                    '<button onclick="copyToClipboard(\'' + data.mockupUrl + '\')" class="copy-btn">Copy Image Link</button>' +
                    '</div>' +
                    '</div>';
                }
                
                // Add ChatGPT prompts section if available
                if (data.chatgptPrompts && data.chatgptPrompts.length > 0) {
                  statusBox.innerHTML += '<div class="prompts-section">' +
                    '<h4 style="color: white; margin: 1rem 0;">🤖 ChatGPT Prompts Used</h4>' +
                    '<div class="prompts-container">' +
                    data.chatgptPrompts.map(function(prompt, index) {
                      return '<div class="prompt-item">' +
                        '<h5 onclick="togglePrompt(' + index + ')" class="prompt-header">' +
                        '<span class="prompt-icon">📄</span>' +
                        'Page ' + (index + 1) + ': ' + (prompt.title || 'Untitled') +
                        '<span class="prompt-toggle">▼</span>' +
                        '</h5>' +
                        '<div id="prompt-content-' + index + '" class="prompt-content">' +
                        '<div class="prompt-text">' + prompt.prompt + '</div>' +
                        '<button onclick="copyToClipboard(\'' + prompt.prompt.replace(/'/g, '\\\'') + '\')" class="copy-btn">Copy Prompt</button>' +
                        '</div>' +
                        '</div>';
                    }).join('') +
                    '</div>' +
                    '</div>';
                }
              
                             submitBtn.disabled = false;
               submitBtn.innerHTML = '🚀 Generate Professional Redesigned Website';
               
               // Deactivate wave animation on completion
               const waveContainer = document.getElementById('wave-container');
               if (waveContainer) {
                 waveContainer.classList.remove('active');
                 console.log('Wave animation deactivated on completion');
               }
             }
           } catch (error) {
            console.error('Error polling status:', error);
            statusBox.className = 'status-active status-error';
            statusBox.innerHTML = '<h3>Error Checking Status</h3>' +
              '<p><strong>Error:</strong> ' + error.message + '</p>' +
              '<p>Please refresh the page and try again.</p>';
                         submitBtn.disabled = false;
             submitBtn.innerHTML = '🚀 Generate Professional Redesigned Website';
             
             // Deactivate wave animation on error
             const waveContainer = document.getElementById('wave-container');
             if (waveContainer) {
               waveContainer.classList.remove('active');
               console.log('Wave animation deactivated due to polling error');
             }
           }
         }
        
        function updateProgress(percentage, step) {
          const progressFill = document.getElementById('progress-fill');
          const currentStepElement = document.getElementById('current-step');
          
          if (progressFill) {
            progressFill.style.width = percentage + '%';
          }
          
          if (currentStepElement) {
            currentStepElement.textContent = step;
          }
          
          console.log('Progress:', percentage + '% -', step);
        }
        
        function copyToClipboard(text) {
          navigator.clipboard.writeText(text).then(function() {
            alert('Link copied to clipboard!');
          }).catch(function(err) {
            console.error('Failed to copy: ', err);
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Link copied to clipboard!');
          });
        }
        
                 console.log('Application initialized successfully');
         
       });

      function normalizeUrl(url) {
        if (!url) return url;
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
          return 'https://' + url;
        }
        return url;
      }
          
      function populateComprehensiveAnalysis(data) {
                         // Page Structure & Content
             const pageStructureContent = document.getElementById('page-structure-content');
             pageStructureContent.innerHTML = 
               '<div class="metric-grid">' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.totalPages || 0) + '</div>' +
                   '<div class="metric-label">Total Pages Found</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.navigationPages || 0) + '</div>' +
                   '<div class="metric-label">Navigation Pages</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.analyzedPages || 0) + '</div>' +
                   '<div class="metric-label">Pages Analyzed</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.averageWordsPerPage || 0) + '</div>' +
                   '<div class="metric-label">Avg Words/Page</div>' +
                 '</div>' +
               '</div>' +
               '<h5>Content Overview:</h5>' +
               '<div class="metric-grid">' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.totalImages || 0) + '</div>' +
                   '<div class="metric-label">Total Images</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.totalHeadings && data.totalHeadings.h1 ? data.totalHeadings.h1 : 0) + '</div>' +
                   '<div class="metric-label">H1 Headings</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.totalHeadings && data.totalHeadings.h2 ? data.totalHeadings.h2 : 0) + '</div>' +
                   '<div class="metric-label">H2 Headings</div>' +
                 '</div>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.totalHeadings && data.totalHeadings.h3 ? data.totalHeadings.h3 : 0) + '</div>' +
                   '<div class="metric-label">H3 Headings</div>' +
                 '</div>' +
               '</div>' +
               (data.navigation && data.navigation.totalLinks > 0 ? 
                 '<h5>Navigation Structure:</h5>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + data.navigation.totalLinks + ' Menu Items</div>' +
                   '<div class="metric-label">Main Navigation Links</div>' +
                 '</div>' : '');
            
                         // SEO Insights
             const seoContent = document.getElementById('seo-insights-content');
             if (data.seoInsights && typeof data.seoInsights === 'object') {
               seoContent.innerHTML = 
                 '<div class="metric-grid">' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.seoInsights.titleOptimal ? '✅' : '❌') + '</div>' +
                     '<div class="metric-label">Title Length (' + (data.seoInsights.titleLength || 0) + ' chars)</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.seoInsights.descriptionOptimal ? '✅' : '❌') + '</div>' +
                     '<div class="metric-label">Description Length (' + (data.seoInsights.descriptionLength || 0) + ' chars)</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.seoInsights.hasTitle ? '✅' : '❌') + '</div>' +
                     '<div class="metric-label">Has Title Tag</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.seoInsights.hasDescription ? '✅' : '❌') + '</div>' +
                     '<div class="metric-label">Has Meta Description</div>' +
                   '</div>' +
                 '</div>';
             } else {
               seoContent.innerHTML = '<p>No SEO insights data available</p>';
             }
            
                         // Link Health
             const linkHealthContent = document.getElementById('link-health-content');
             if (data.linkHealth && typeof data.linkHealth === 'object') {
               linkHealthContent.innerHTML = 
                 '<div class="metric-grid">' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.linkHealth.internalLinks || 0) + '</div>' +
                     '<div class="metric-label">Internal Pages</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.linkHealth.navigationLinks || 0) + '</div>' +
                     '<div class="metric-label">Navigation Links</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.linkHealth.externalLinks || 0) + '</div>' +
                     '<div class="metric-label">External Links</div>' +
                   '</div>' +
                   '<div class="metric-card">' +
                     '<div class="metric-value">' + (data.linkHealth.deadLinks || 0) + '</div>' +
                     '<div class="metric-label">Dead Links</div>' +
                   '</div>' +
                 '</div>' +
                 (data.linkHealth.deadLinks > 0 ? 
                   '<div class="metric-card" style="margin-top: 1rem; border-left-color: #dc3545;">' +
                     '<div class="metric-value" style="color: #dc3545;">' + (data.linkHealth.deadLinkPercentage || 0) + '%</div>' +
                     '<div class="metric-label">Dead Link Percentage</div>' +
                   '</div>' : '');
             } else {
               linkHealthContent.innerHTML = '<p>No link health data available</p>';
             }
            
                         // Keywords
             const keywordsContent = document.getElementById('keywords-content');
             if (data.topKeywords && Array.isArray(data.topKeywords) && data.topKeywords.length > 0) {
               keywordsContent.innerHTML = 
                 '<h5>Top 20 Keywords:</h5>' +
                 '<div style="margin: 1rem 0;">' +
                   data.topKeywords.map(function(keyword) {
                     return '<span class="keyword-tag">' + keyword.word + ' (' + keyword.count + ')</span>';
                   }).join('') +
                 '</div>';
             } else {
               keywordsContent.innerHTML = '<h5>Top Keywords:</h5><p>No keyword data available</p>';
             }
            
                         // Page Content
             const pageContentDiv = document.getElementById('page-content-content');
             if (data.pageContent && Array.isArray(data.pageContent) && data.pageContent.length > 0) {
               pageContentDiv.innerHTML = 
                 '<h5>Analyzed Pages:</h5>' +
                 data.pageContent.map(function(page) {
                   return '<div class="page-item">' +
                     '<div class="page-title">' + (page.title || 'Untitled') + '</div>' +
                     '<div class="page-url">' + (page.url || 'No URL') + '</div>' +
                     '<div class="page-stats">' +
                       '<span>Words: ' + (page.wordCount || 0) + '</span>' +
                       '<span>Content: ' + (page.content ? page.content.substring(0, 100) + '...' : 'No content') + '</span>' +
                     '</div>' +
                   '</div>';
                 }).join('');
             } else {
               pageContentDiv.innerHTML = '<h5>Analyzed Pages:</h5><p>No page content data available</p>';
             }
            
                         // Meta Data
             const metaDataContent = document.getElementById('meta-data-content');
             if (data.metaDataSummary && typeof data.metaDataSummary === 'object' && Object.keys(data.metaDataSummary).length > 0) {
               metaDataContent.innerHTML = 
                 '<h5>Meta Tags Found:</h5>' +
                 Object.entries(data.metaDataSummary).map(function([name, values]) {
                   return '<div class="analysis-item">' +
                     '<strong>' + name + ':</strong> ' +
                     (Array.isArray(values) ? values.join(', ') : values) +
                   '</div>';
                 }).join('');
             } else {
               metaDataContent.innerHTML = '<h5>Meta Tags Found:</h5><p>No meta data available</p>';
             }

                         // Navigation Analysis
             const navigationAnalysisContent = document.getElementById('navigation-analysis-content');
             if (data.navigation && data.navigation.links && Array.isArray(data.navigation.links) && data.navigation.links.length > 0) {
               navigationAnalysisContent.innerHTML = 
                 '<h5>Navigation Links Found:</h5>' +
                 '<div class="metric-card">' +
                   '<div class="metric-value">' + (data.navigation.totalLinks || data.navigation.links.length) + '</div>' +
                   '<div class="metric-label">Total Navigation Items</div>' +
                 '</div>' +
                 '<h6>Navigation Structure:</h6>' +
                 data.navigation.links.map(function(linkUrl) {
                   if (typeof linkUrl === 'string') {
                     const linkText = linkUrl.split('/').pop().replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) || 'Home';
                     return '<div class="page-item">' +
                       '<div class="page-title">' + linkText + '</div>' +
                       '<div class="page-url">' + linkUrl + '</div>' +
                     '</div>';
                   }
                   return '';
                 }).filter(item => item !== '').join('');
             } else {
               navigationAnalysisContent.innerHTML = 
                 '<div class="metric-card">' +
                   '<div class="metric-value">0</div>' +
                   '<div class="metric-label">Navigation Links Found</div>' +
                 '</div>' +
                 '<p>No clear navigation structure detected. This might be a single-page website or navigation is implemented differently.</p>';
             }
          }
          
          function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const header = section.previousElementSibling;
            
            if (section.classList.contains('active')) {
              section.classList.remove('active');
              header.classList.remove('active');
            } else {
              section.classList.add('active');
              header.classList.add('active');
            }
          }

                 function togglePrompt(index) {
         const promptContent = document.getElementById('prompt-content-' + index);
         const promptHeader = promptContent.previousElementSibling;
         
         if (promptContent.classList.contains('active')) {
           promptContent.classList.remove('active');
           promptHeader.classList.remove('active');
         } else {
           promptContent.classList.add('active');
           promptHeader.classList.add('active');
         }
       }
       
       // Database setup function
       async function setupDatabase() {
         try {
           const response = await fetch('/api/setup-database', { method: 'POST' });
           const data = await response.json();
           
           if (data.message) {
             alert('Database setup completed! Please try your request again.');
             location.reload();
           } else {
             alert('Database setup failed: ' + (data.error || 'Unknown error'));
           }
         } catch (error) {
           alert('Database setup error: ' + error.message);
         }
       }
    </script>
  </body>
</html>
